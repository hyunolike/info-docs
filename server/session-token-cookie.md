## Cookie Session Token
> [참고 자료](https://tofusand-dev.tistory.com/89) <br> 
> [JWT & Spring Security](https://brunch.co.kr/@springboot/491)
- 인증 방식 크게 3가지 
  - 계정 정보를 요청 Header에 넣는 방식 >> 절대 이렇게 해서는 안됨! ❌
  - Session/Cookie 방식
  - Token 기반 인증 방식

### 1. `Session`/`Cookie` 방식
- 기본적으로 __세션 저장소__ 필요
  - 세션 저장소 >> 로그인시 사용자 __정보 저장__ 및 열쇠로 사용할 수 있는 __세션ID__ 생성
  - HTTP 헤더에 실어 클라이언트에 전송
- 브라우저 >> 세션ID 포함하는 쿠키 저장
  - 인증에 필요한 요청에 해당 쿠키를 끼워 서버에 요청 보냄

#### 1.1 인증 절차
1. 사용자 로그인
2. 서버에서는 계정 정보를 읽어 사용자 확인 후, 사용자 고유ID 값 부여한 후 세션 저장소에 저장하고, 이와 연결되는 세션ID 발행
3. 클라이언트는 서버에서 해당 세션ID 받아 쿠키에 저장한 후, 인증이 필요한 요청마다 쿠키를 헤더에 끼워 보냄
4. 서버에서는 쿠키를 받아 세션 저장소에서 확인 후, 일치하는 정보 가져옴
5. 인증 완료된 후, 서버는 사용자에 맞는 데이터 보내줌

#### 1.2 차이
- Session 
  -  서버에서 가지고있는 정보
- Cookie
  - 서버에서 발급된 세션을 열기 위한 키 값(세션ID라고 칭함)
#### 1.3 참고
- 쿠키만을 사용할 때 문제점
  - 서버 자원 사용하지 않는다는 것 >> 클라이언트가 인증 정보 책임지는 것 의미
  - 쿠키는 조작된 데이터일 수 있기에 실제 정보가 존재하는 디비 사용해 작업
- 인증의 책임 >> 서버에 지기 위해 __세션__ 과 함께 사용! ✔
  - `사용자`: 쿠키 
  - `서버`: 쿠키 받아 세션의 정보를 접근하는 방식으로 인증 
#### 1.4 장단점
- 장점
  1. 쿠키가 담긴 HTTP 요청이 노출되더라도 쿠키 자체는 유의미한 값을 갖고 있지 않음(중요한 정보는 서버 세션에 존재)
  2. 고유의 ID값 발급
- 단점
  1. 세션 하이재킹 공격 가능 >> 해결책. HTTPS 사용해 요청 자체 탈취해도 안의 정보 읽기 힘들게 하거나, 세션에 유효시간 부여
  2. 서버에서 추가적인 저장공간 필요 >> 세션 저장소 사용하므로 부하 높아짐

### 2. Token 기반 인증 방식
- JWT(JSON Web Token): 인증에 필요한 정보들을 암호화시킨 토큰
- 세션/쿠키 방식가 유사하게 사용자는 Access Token(JWT Token)을 HTTP 헤더에 실어 서버에 전송
- 토큰은 임의로 생성된 비밀번호 같이 동작
  - 제한된 수명
  - 새로운 토큰 >> 한번 만료되면 새로 생성(Refresh Token)

#### 2.1 인증 절차
1. 사용자 로그인
2. 서버에서는 계정 정보 읽어 사용자 확인 후, 사용자의 고유 ID값 부여한 후 기타 정보와 함께 Payload 집어넣음
3. JWT 토큰의 유효기간 설정
4. 암호화할 Secret key 이용해 Access Token 발급
5. 사용자 Access Token 받아 저장 후, 인증이 필요한 요청마다 토큰을 헤더에 실어 보냄
6. 서버에서는 해당 토큰의 Verify Signature를 Secret key 복호화한 후, 조작 여부, 유효기간 확인
7. 검증 완료된 후, Payload 디코딩하여 사용자의 ID에 맞는 데이터 가져옴

#### 2.2 세션/쿠키와의 차이와 공통점
- 차이 ✔
  - 세션/쿠키의 유저정보: 세션 저장소
  - JWT의 유저정보: 토큰 안에 유저의 정보
  - 서버 입장: 인증을 위해 암호화(JWT) VS 별도의 저장소 이용(세션/쿠키)
- 공통 ✔
  - 클라이언트 입장: HTTP 헤더에 세션 ID나 토큰을 실어서 보내줌

#### 2.3 장단점
- 장점
  1. 간편함 >> JWT는 발급한 후 검증만 하기에 추가 저장소 필요X 
  2. 확장성 뛰어남 >> 토큰 기반으로 하는 다른 인증 시스템에 접근 가능
- 단점
  1. 이미 발급된 JWT에 대해서는 유효기간이 완료될 때까지 계속 사용 가능 >> Access Token(유효기간 짧음) / Refresh Token(새로운 토큰 발급)
  2. Payload 정보가 제한적
  3. JWT 길이 >> 길이 길기에 요청 많아질수록 서버의 자원낭비 발생
